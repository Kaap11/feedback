<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAAP11 Transcriptie & Feedback Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 12px;
            margin: 0 5px;
            border-radius: 5px;
            background: #e9ecef;
            color: #6c757d;
            font-weight: bold;
            font-size: 14px;
        }
        .step.active {
            background: #007cba;
            color: white;
        }
        .step.completed {
            background: #28a745;
            color: white;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input, button, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 150px;
            font-family: Georgia, serif;
            line-height: 1.6;
            resize: vertical;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        button:hover:not(:disabled) {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .success-btn {
            background: #28a745;
        }
        .success-btn:hover:not(:disabled) {
            background: #218838;
        }
        .secondary-btn {
            background: #6c757d;
        }
        .secondary-btn:hover:not(:disabled) {
            background: #545b62;
        }
        .status {
            padding: 12px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
            font-weight: 500;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background: #007cba;
            width: 0%;
            transition: width 0.5s ease;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }
        .analysis-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .analysis-type {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .analysis-type:hover {
            border-color: #007cba;
        }
        .analysis-type.selected {
            border-color: #007cba;
            background: #f8f9fa;
        }
        .analysis-type h3 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }
        .analysis-type p {
            margin: 0;
            color: #666;
            font-size: 13px;
        }
        .custom-instruction {
            min-height: 120px;
            display: none;
        }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 14px;
            color: #1565c0;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-group button {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>KAAP11 Transcriptie & Feedback Tool</h1>
        
        <!-- Progress Steps -->
        <div class="steps">
            <div class="step active">1. Setup</div>
            <div class="step">2. Transcriptie</div>
            <div class="step">3. Kandidaat Type</div>
            <div class="step">4. Feedback</div>
        </div>

        <!-- Setup Section -->
        <div class="section">
            <h2>Setup</h2>
            <div class="input-group">
                <label>OpenAI API Key:</label>
                <input type="password" id="openaiKey" placeholder="sk-proj-... of sk-...">
                <div class="info-box" style="margin-top: 5px;">
                    ‚ÑπÔ∏è Gebruikt voor Whisper transcriptie en ChatGPT feedback analyse
                </div>
            </div>
            
            <div class="input-group">
                <label>Audio Bestand:</label>
                <input type="file" id="audioFile" accept="audio/*">
                <audio id="audioPlayer" controls style="display:none;"></audio>
            </div>
            
            <button id="transcribeBtn" disabled>Start Transcriptie</button>
            
            <div class="progress-bar" id="progressBar1">
                <div class="progress-fill" id="progressFill1"></div>
            </div>
            
            <div id="status1" class="status"></div>
        </div>

        <!-- Transcription Section -->
        <div class="section" id="transcriptionSection" style="display:none;">
            <h2>Transcriptie</h2>
            <div class="info-box">
                ‚úÖ Transcriptie voltooid! Je kunt de tekst hieronder bewerken.
            </div>
            <div class="input-group">
                <label>Transcriptie (bewerkbaar):</label>
                <textarea id="transcriptionResult"></textarea>
            </div>
        </div>

        <!-- Candidate Type Section -->
        <div class="section" id="candidateTypeSection" style="display:none;">
            <h2>Kandidaat Type Bepaling</h2>
            
            <div class="info-box">
                Voor recruitment feedback moeten we bepalen welk type kandidaat dit is.
            </div>
            
            <button id="detectTypeBtn" class="secondary-btn" disabled>Analyseer Kandidaat Type</button>
            
            <div class="progress-bar" id="progressBar2">
                <div class="progress-fill" id="progressFill2"></div>
            </div>
            
            <div id="status2" class="status"></div>
            
            <div id="typeResultSection" style="display:none;">
                <div class="input-group">
                    <label>AI Analyse:</label>
                    <textarea id="typeAnalysis" readonly style="min-height: 120px;"></textarea>
                </div>
                
                <div class="input-group">
                    <label>Bevestig kandidaat type:</label>
                    <select id="candidateTypeSelect">
                        <option value="">-- Kies type --</option>
                        <option value="actief">Actief Zoekende Kandidaat</option>
                        <option value="latent">Latente Kandidaat</option>
                        <option value="niet-zoekend">Niet Zoekende Kandidaat</option>
                    </select>
                </div>
                
                <button id="proceedBtn" class="success-btn" disabled>Ga naar Feedback</button>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="section" id="analysisSection" style="display:none;">
            <h2>Feedback Type</h2>
            
            <div class="analysis-options">
                <div class="analysis-type selected" id="recruitmentType">
                    <h3>üéØ Recruitment Feedback</h3>
                    <p>KAAP11 methodiek voor recruiters</p>
                </div>
                <div class="analysis-type" id="customType">
                    <h3>‚öôÔ∏è Custom Feedback</h3>
                    <p>Eigen instructies</p>
                </div>
            </div>
            
            <div class="input-group">
                <textarea id="customInstruction" class="custom-instruction" placeholder="Eigen feedback instructies..."></textarea>
            </div>
            
            <button id="generateBtn" class="success-btn" disabled>Genereer Feedback</button>
            
            <div class="progress-bar" id="progressBar3">
                <div class="progress-fill" id="progressFill3"></div>
            </div>
            
            <div id="status3" class="status"></div>
        </div>

        <!-- Results Section -->
        <div class="section" id="resultsSection" style="display:none;">
            <h2>Feedback Resultaat</h2>
            <div class="input-group">
                <label>Feedback:</label>
                <textarea id="feedbackResult" readonly></textarea>
            </div>
            
            <div class="btn-group">
                <button id="newFeedbackBtn" class="secondary-btn">Nieuwe Feedback</button>
                <button id="restartBtn" class="secondary-btn">Herstart</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let audioData = null;
        let currentStep = 1;
        let analysisType = 'recruitment';
        let candidateType = null;
        
        const recruitmentInstruction = `# Feedback Agent voor Recruiter Intakegesprekken

## Rol en Doel
Je bent een feedback agent gespecialiseerd in het analyseren van kandidaat intakegesprekken van recruiters. Je taak is om constructieve feedback te geven gebaseerd op de Kaap11 training methodieken voor 'Kandidaat intake' en 'Verleiden van je kandidaat'.

## Feedback Methodiek
Gebruik een aangepaste versie van de CHECK methode, aangepast voor eenzijdige schriftelijke feedback:

### Stap 1: Identificeer het gesprektype (VERPLICHT)
Bepaal eerst of het een gesprek betreft met:
- **Actief zoekende kandidaat** (voor openstaande vacature/opdracht)
- **Latente kandidaat** (ori√´nterend gesprek voor toekomstige samenwerking)

Als dit niet duidelijk is uit de context, vraag dit expliciet aan de gebruiker.

### Stap 2: Evalueer per focuspunt
Geef feedback op de relevante aspecten gebaseerd op het gesprektype:

#### Voor Actief Zoekende Kandidaten:
Structureer feedback volgens het **RedCarpet Intakeformulier**:

**1. Opening - Eerste Indruk**
- Voorstellen (naam, bedrijf, specialisme)
- Aanleiding (bron van contact)
- Routeplanner (verwachtingen schets)
- Check beschikbaarheid

**2. Intake - De Verdieping**
- **Wat kan je?** (werkervaring, vaardigheden, competenties)
- **Wat wil je?** (werkomgeving, functie, arbeidsvoorwaarden)
- **Commitment & Status** (motivatie, beschikbaarheid, andere sollicitaties)

**3. Vervolg - De Pitch**
- Match aangeven
- Verwachtingen managen
- Dossier aanvullen

**4. Afsluiten**
- Samenvatting & situatie schetsen
- Concrete vervolgafspraak
- Actiepunten benoemen

#### Voor Latente Kandidaten:
Gebruik het **W.E.R.K. model** en **6 stappen gesprekscyclus**:

**W.E.R.K. Model:**
- **Wensen & ambities** (toekomstige carri√®redoelen)
- **Ervaring en werkzaamheden** (huidig en verleden)
- **Recruitment** (zoekgedrag en ervaring met bureaus)
- **Kandidaat** (persoonlijke aspecten, relatiebuilding)

**6 Stappen Gesprekscyclus:**
1. **Voorbereiding** (research, strategie)
2. **Opening** (5-stappen structuur + pimpen)
3. **Gespreksfase** (W.E.R.K. + LRD techniek)
4. **Pitch** (organisatie, team, jij)
5. **Afsluiten** (vervolgstappen bepalen)
6. **Opvolgen** (relatiebeheer)

**4 Fases Relatieopbouw:**
- Know ‚Üí Like ‚Üí Trust ‚Üí Recommend

### Stap 3: Geef Concrete Feedback
Voor elk focuspunt:

**Feedback (leren van situatie):**
- Wat ging goed? Waarom was dit effectief?
- Wat ging minder goed? Wat was het effect hiervan?

**Feedforward (toekomst):**
- Wat kan behouden blijven? Hoe?
- Wat kan anders/beter? Concrete suggesties?

### Stap 4: Belangrijkste Leerpunten
Vat samen:
- Top 3 sterke punten
- Top 3 verbeterpunten met concrete acties
- Specifieke aanbevelingen voor volgende gesprekken

### Stap 5: Aanmoediging
Sluit af met motiverende woorden en vertrouwen in verbetering.

## Specifieke Aandachtspunten

### Gespreks- en Vraagtechnieken
- **LRD techniek** (Luisteren, Reageren, Doorvragen)
- **Open vragen** en goede inleiding
- **Containerbegrippen** en **subjectieve begrippen** herkennen
- **STAR methodiek** voor competentie-uitvragen

### Relatieopbouw (vooral latente kandidaten)
- Persoonlijke connectie maken
- Vertrouwen opbouwen door expertise tonen
- Interesse tonen in persoon achter het CV

### Commerci√´le Focus
- **GASS methode** (Gets, Accepts, Starts, Stays)
- Urgentie cre√´ren waar relevant
- Verwachtingen managen
- Commitment peilen en versterken

### Dienstverlening Context
Houd rekening met deze diensten:
1. **Werving & Selectie** (direct in dienst bij opdrachtgever)
2. **Detachering** (in dienst bij bureau)
3. **Deta-vast** (eerst detachering, dan vast)
4. **Interim/Freelance** (ZZP opdrachten)

## Feedback Stijl
- **Constructief en specifiek**: Geef concrete voorbeelden
- **Gebalanceerd**: Balans tussen lof en verbeterpunten
- **Ontwikkelingsgericht**: Focus op groei en leren
- **Praktisch**: Directe tips die morgen toegepast kunnen worden
- **Motiverend**: Sluit positief af met aanmoediging

## Template Start
Begin elke feedback met:
"Bedankt voor het delen van je gesprek. Ik ga je feedback geven op basis van de Kaap11 methodiek. Eerst wil ik bevestigen: was dit een gesprek met een **actief zoekende** of **latente** kandidaat?"

[Wacht op bevestiging voordat je verder gaat met de analyse]`;

        // Initialize
        document.addEventListener('DOMContentLoaded', init);
        
        function init() {
            loadSavedKeys();
            setupEventListeners();
            updateStepIndicators();
        }
        
        function loadSavedKeys() {
            const saved = localStorage.getItem('openai_api_key');
            if (saved) {
                document.getElementById('openaiKey').value = saved;
            }
            validateStep1();
        }
        
        function setupEventListeners() {
            // Step 1
            document.getElementById('openaiKey').addEventListener('input', validateStep1);
            document.getElementById('audioFile').addEventListener('change', handleFileUpload);
            document.getElementById('transcribeBtn').addEventListener('click', startTranscription);
            
            // Step 2 (candidate type)
            document.getElementById('detectTypeBtn').addEventListener('click', detectCandidateType);
            document.getElementById('candidateTypeSelect').addEventListener('change', validateStep3);
            document.getElementById('proceedBtn').addEventListener('click', proceedToFeedback);
            
            // Step 3 (analysis)
            document.getElementById('recruitmentType').addEventListener('click', () => selectAnalysisType('recruitment'));
            document.getElementById('customType').addEventListener('click', () => selectAnalysisType('custom'));
            document.getElementById('customInstruction').addEventListener('input', validateStep4);
            document.getElementById('generateBtn').addEventListener('click', generateFeedback);
            
            // Controls
            document.getElementById('newFeedbackBtn').addEventListener('click', newFeedback);
            document.getElementById('restartBtn').addEventListener('click', restart);
            
            // Text area auto-resize
            document.addEventListener('input', function(e) {
                if (e.target.tagName === 'TEXTAREA') {
                    autoResize(e.target);
                }
            });
        }
        
        // Validation functions
        function validateStep1() {
            const hasKey = document.getElementById('openaiKey').value.length > 0;
            const hasAudio = audioData !== null;
            document.getElementById('transcribeBtn').disabled = !hasKey || !hasAudio;
        }
        
        function validateStep2() {
            const hasText = document.getElementById('transcriptionResult').value.trim().length > 0;
            document.getElementById('detectTypeBtn').disabled = !hasText;
        }
        
        function validateStep3() {
            const hasSelection = document.getElementById('candidateTypeSelect').value.length > 0;
            document.getElementById('proceedBtn').disabled = !hasSelection;
        }
        
        function validateStep4() {
            const hasText = document.getElementById('transcriptionResult').value.trim().length > 0;
            const hasInstruction = analysisType === 'recruitment' || document.getElementById('customInstruction').value.trim().length > 0;
            const hasType = analysisType !== 'recruitment' || candidateType !== null;
            document.getElementById('generateBtn').disabled = !hasText || !hasInstruction || !hasType;
        }
        
        // File upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                audioData = null;
                validateStep1();
                return;
            }
            
            // Validation
            if (file.size > 25 * 1024 * 1024) {
                showStatus('Bestand te groot (max 25MB)', 'error', 1);
                return;
            }
            
            const ext = file.name.toLowerCase().split('.').pop();
            const formats = ['mp3', 'wav', 'm4a', 'ogg', 'webm', 'flac'];
            if (!formats.includes(ext)) {
                showStatus('Formaat niet ondersteund', 'error', 1);
                return;
            }
            
            audioData = file;
            
            // Show player
            const player = document.getElementById('audioPlayer');
            player.src = URL.createObjectURL(file);
            player.style.display = 'block';
            
            const sizeMB = (file.size / 1024 / 1024).toFixed(1);
            showStatus(`Audio geladen: ${file.name} (${sizeMB}MB)`, 'success', 1);
            
            validateStep1();
        }
        
        // Transcription
        async function startTranscription() {
            const key = document.getElementById('openaiKey').value;
            
            setButtonDisabled('transcribeBtn', true);
            showProgress(1, 25);
            showStatus('Transcriptie wordt uitgevoerd...', 'success', 1);
            
            try {
                const formData = new FormData();
                formData.append('file', audioData);
                formData.append('model', 'whisper-1');
                formData.append('language', 'nl');
                
                showProgress(1, 50);
                
                const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${key}` },
                    body: formData
                });
                
                showProgress(1, 75);
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`API error: ${error}`);
                }
                
                const result = await response.json();
                if (!result.text) {
                    throw new Error('Geen transcriptie ontvangen');
                }
                
                document.getElementById('transcriptionResult').value = result.text;
                localStorage.setItem('openai_api_key', key);
                
                showProgress(1, 100);
                showStatus('Transcriptie voltooid!', 'success', 1);
                
                // Show next section
                document.getElementById('transcriptionSection').style.display = 'block';
                document.getElementById('candidateTypeSection').style.display = 'block';
                
                autoResize(document.getElementById('transcriptionResult'));
                validateStep2();
                
                setTimeout(() => {
                    hideProgress(1);
                    goToStep(3);
                }, 2000);
                
            } catch (error) {
                showStatus(`Fout: ${error.message}`, 'error', 1);
                hideProgress(1);
            } finally {
                setButtonDisabled('transcribeBtn', false);
            }
        }
        
        // Candidate type detection
        async function detectCandidateType() {
            const key = document.getElementById('openaiKey').value;
            const text = document.getElementById('transcriptionResult').value;
            
            setButtonDisabled('detectTypeBtn', true);
            showProgress(2, 25);
            showStatus('AI analyseert kandidaat type...', 'success', 2);
            
            try {
                const prompt = `Analyseer deze transcriptie en bepaal het kandidaat type:

**ACTIEF ZOEKEND**: Expliciet zoekgedrag, urgentie, concrete verwachtingen
**LATENT**: Passieve interesse, voorwaardelijk, exploratie  
**NIET ZOEKEND**: Afwijzend, geen interesse, sterke huidige binding

Transcriptie:
${text}

Geef analyse in format:
1. **CONCLUSIE:** [ACTIEF ZOEKEND/LATENT/NIET ZOEKEND]
2. **BEWIJS:** [Citaten uit tekst]
3. **MOTIVATIE:** [Waarom deze conclusie]`;
                
                showProgress(2, 50);
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 1500,
                        temperature: 0.2
                    })
                });
                
                showProgress(2, 75);
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`API error: ${error}`);
                }
                
                const result = await response.json();
                const analysis = result.choices[0].message.content;
                
                document.getElementById('typeAnalysis').value = analysis;
                document.getElementById('typeResultSection').style.display = 'block';
                
                // Auto-select type
                if (analysis.includes('ACTIEF ZOEKEND')) {
                    document.getElementById('candidateTypeSelect').value = 'actief';
                } else if (analysis.includes('LATENT')) {
                    document.getElementById('candidateTypeSelect').value = 'latent';
                } else if (analysis.includes('NIET ZOEKEND')) {
                    document.getElementById('candidateTypeSelect').value = 'niet-zoekend';
                }
                
                showProgress(2, 100);
                showStatus('Type analyse voltooid!', 'success', 2);
                
                autoResize(document.getElementById('typeAnalysis'));
                validateStep3();
                
                setTimeout(() => hideProgress(2), 2000);
                
            } catch (error) {
                showStatus(`Fout: ${error.message}`, 'error', 2);
                hideProgress(2);
            } finally {
                setButtonDisabled('detectTypeBtn', false);
            }
        }
        
        function proceedToFeedback() {
            candidateType = document.getElementById('candidateTypeSelect').value;
            document.getElementById('analysisSection').style.display = 'block';
            goToStep(4);
            validateStep4();
        }
        
        // Analysis type selection
        function selectAnalysisType(type) {
            analysisType = type;
            
            document.getElementById('recruitmentType').classList.toggle('selected', type === 'recruitment');
            document.getElementById('customType').classList.toggle('selected', type === 'custom');
            
            const customField = document.getElementById('customInstruction');
            customField.style.display = type === 'custom' ? 'block' : 'none';
            
            if (type === 'custom') {
                const saved = localStorage.getItem('custom_instruction');
                if (saved) customField.value = saved;
                candidateType = null;
            }
            
            validateStep4();
        }
        
        // Feedback generation
        async function generateFeedback() {
            const key = document.getElementById('openaiKey').value;
            const text = document.getElementById('transcriptionResult').value;
            
            let instruction = '';
            if (analysisType === 'recruitment') {
                const typeText = candidateType === 'actief' ? 'actief zoekende' : 
                               candidateType === 'latent' ? 'latente' : 'niet zoekende';
                instruction = `${recruitmentInstruction}\n\nBELANGRIJK: Dit is een **${typeText} kandidaat**.`;
            } else {
                instruction = document.getElementById('customInstruction').value;
                localStorage.setItem('custom_instruction', instruction);
            }
            
            setButtonDisabled('generateBtn', true);
            showProgress(3, 25);
            showStatus('Feedback wordt gegenereerd...', 'success', 3);
            
            try {
                const prompt = `${instruction}\n\n---\n\nTranscriptie:\n${text}\n\nGeef feedback volgens bovenstaande instructies.`;
                
                showProgress(3, 50);
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 4000,
                        temperature: 0.3
                    })
                });
                
                showProgress(3, 75);
                
                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(`API error: ${error}`);
                }
                
                const result = await response.json();
                const feedback = result.choices[0].message.content;
                
                document.getElementById('feedbackResult').value = feedback;
                document.getElementById('resultsSection').style.display = 'block';
                
                showProgress(3, 100);
                showStatus('Feedback gegenereerd!', 'success', 3);
                
                autoResize(document.getElementById('feedbackResult'));
                
                setTimeout(() => {
                    hideProgress(3);
                    document.getElementById('resultsSection').scrollIntoView({
                        behavior: 'smooth'
                    });
                }, 2000);
                
            } catch (error) {
                showStatus(`Fout: ${error.message}`, 'error', 3);
                hideProgress(3);
            } finally {
                setButtonDisabled('generateBtn', false);
            }
        }
        
        // Control functions
        function newFeedback() {
            document.getElementById('feedbackResult').value = '';
            document.getElementById('resultsSection').style.display = 'none';
            
            if (analysisType === 'recruitment') {
                candidateType = null;
                document.getElementById('candidateTypeSelect').value = '';
                validateStep3();
            } else {
                document.getElementById('customInstruction').value = '';
            }
            
            validateStep4();
            goToStep(4);
        }
        
        function restart() {
            // Reset all data
            audioData = null;
            candidateType = null;
            analysisType = 'recruitment';
            currentStep = 1;
            
            // Clear form fields
            document.getElementById('audioFile').value = '';
            document.getElementById('audioPlayer').style.display = 'none';
            document.getElementById('transcriptionResult').value = '';
            document.getElementById('typeAnalysis').value = '';
            document.getElementById('candidateTypeSelect').value = '';
            document.getElementById('customInstruction').value = '';
            document.getElementById('feedbackResult').value = '';
            
            // Hide sections
            document.getElementById('transcriptionSection').style.display = 'none';
            document.getElementById('candidateTypeSection').style.display = 'none';
            document.getElementById('typeResultSection').style.display = 'none';
            document.getElementById('analysisSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            
            // Hide progress and status
            hideProgress(1);
            hideProgress(2);
            hideProgress(3);
            document.getElementById('status1').style.display = 'none';
            document.getElementById('status2').style.display = 'none';
            document.getElementById('status3').style.display = 'none';
            
            // Reset UI
            goToStep(1);
            selectAnalysisType('recruitment');
            validateStep1();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Utility functions
        function goToStep(step) {
            currentStep = step;
            updateStepIndicators();
        }
        
        function updateStepIndicators() {
            const steps = document.querySelectorAll('.step');
            steps.forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.remove('active', 'completed');
                if (stepNum < currentStep) {
                    step.classList.add('completed');
                } else if (stepNum === currentStep) {
                    step.classList.add('active');
                }
            });
        }
        
        function showStatus(message, type, step) {
            const status = document.getElementById(`status${step}`);
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }
        
        function showProgress(step, percentage) {
            const bar = document.getElementById(`progressBar${step}`);
            const fill = document.getElementById(`progressFill${step}`);
            bar.style.display = 'block';
            fill.style.width = `${percentage}%`;
        }
        
        function hideProgress(step) {
            document.getElementById(`progressBar${step}`).style.display = 'none';
            document.getElementById(`progressFill${step}`).style.width = '0%';
        }
        
        function setButtonDisabled(buttonId, disabled) {
            document.getElementById(buttonId).disabled = disabled;
        }
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(textarea.scrollHeight, 150) + 'px';
        }
    </script>
</body>
</html>
