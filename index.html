<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAAP11 MVP Transcriptie & Feedback Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 12px;
            margin: 0 5px;
            border-radius: 5px;
            background: #e9ecef;
            color: #6c757d;
            font-weight: bold;
            font-size: 14px;
        }
        .step.active {
            background: #007cba;
            color: white;
        }
        .step.completed {
            background: #28a745;
            color: white;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        input, button, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 150px;
            font-family: Georgia, serif;
            line-height: 1.6;
            resize: vertical;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }
        button:hover:not(:disabled) {
            background: #005a87;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .success-btn {
            background: #28a745;
        }
        .success-btn:hover:not(:disabled) {
            background: #218838;
        }
        .secondary-btn {
            background: #6c757d;
        }
        .secondary-btn:hover:not(:disabled) {
            background: #545b62;
        }
        .status {
            padding: 12px;
            margin: 15px 0;
            border-radius: 5px;
            display: none;
            font-weight: 500;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background: #007cba;
            width: 0%;
            transition: width 0.5s ease;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
        }
        .analysis-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .analysis-type {
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        .analysis-type:hover {
            border-color: #007cba;
        }
        .analysis-type.selected {
            border-color: #007cba;
            background: #f8f9fa;
        }
        .analysis-type h3 {
            margin: 0 0 8px 0;
            color: #333;
            font-size: 16px;
        }
        .analysis-type p {
            margin: 0;
            color: #666;
            font-size: 13px;
        }
        .custom-instruction {
            min-height: 120px;
            display: none;
        }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 14px;
            color: #1565c0;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        .btn-group button {
            flex: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>KAAP11 MVP Transcriptie & Feedback Tool</h1>
        
        <!-- Progress Steps -->
        <div class="steps">
            <div class="step active">1. Audio Upload</div>
            <div class="step">2. Transcriptie</div>
            <div class="step">3. Kandidaat Type</div>
            <div class="step">4. Feedback</div>
        </div>

        <!-- API Keys Section -->
        <div class="section">
            <h2>Setup</h2>
            <div class="input-group">
                <label>OpenAI API Key (voor transcriptie √©n feedback):</label>
                <input type="password" id="openaiKey" placeholder="sk-proj-... of sk-...">
                <div class="info-box" style="margin-top: 5px;">
                    ‚ÑπÔ∏è Deze key wordt gebruikt voor zowel Whisper transcriptie als ChatGPT feedback analyse
                </div>
            </div>
        </div>

        <!-- Audio Upload Section -->
        <div class="section">
            <h2>Audio Upload</h2>
            <div class="input-group">
                <label>Selecteer Audio Bestand:</label>
                <input type="file" id="audioFile" accept="audio/*">
                <audio id="audioPlayer" controls style="display:none;"></audio>
            </div>
            
            <button id="transcribeBtn" disabled>Start Transcriptie</button>
            
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div id="status" class="status"></div>
        </div>

        <!-- Transcription Result -->
        <div class="section" id="transcriptionSection" style="display:none;">
            <h2>Transcriptie Resultaat</h2>
            <div class="info-box">
                ‚úÖ Transcriptie voltooid! Je kunt de tekst hieronder nog bewerken voordat we verder gaan.
            </div>
            <div class="input-group">
                <label>Transcriptie (bewerkbaar):</label>
                <textarea id="transcriptionResult" placeholder="Hier verschijnt de transcriptie..."></textarea>
            </div>
        </div>

        <!-- Candidate Type Detection Section -->
        <div class="section" id="candidateTypeSection" style="display:none;">
            <h2>Kandidaat Type Bepaling</h2>
            
            <div class="info-box">
                ‚ÑπÔ∏è Voor gerichte feedback moeten we eerst bepalen wat voor type kandidaat dit is.
            </div>
            
            <button id="detectCandidateTypeBtn" class="secondary-btn" disabled>Analyseer Kandidaat Type</button>
            
            <div class="progress-bar" id="candidateProgressBar">
                <div class="progress-fill" id="candidateProgressFill"></div>
            </div>
            
            <div id="candidateStatus" class="status"></div>
            
            <div id="candidateTypeResult" style="display:none;">
                <div class="input-group">
                    <label>AI Analyse Resultaat:</label>
                    <textarea id="candidateAnalysis" readonly style="min-height: 120px;"></textarea>
                </div>
                
                <div class="input-group">
                    <label>Bevestig of corrigeer het kandidaat type:</label>
                    <select id="candidateTypeSelect">
                        <option value="">-- Selecteer kandidaat type --</option>
                        <option value="actief">Actief Zoekende Kandidaat</option>
                        <option value="latent">Latente Kandidaat</option>
                        <option value="niet-zoekend">Niet Zoekende Kandidaat</option>
                    </select>
                </div>
                
                <button id="proceedToFeedbackBtn" class="success-btn" disabled>Ga naar Feedback Generatie</button>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="section" id="analysisSection" style="display:none;">
            <h2>Feedback Generatie</h2>
            
            <div class="input-group">
                <label>Kies Feedback Type:</label>
                <div class="analysis-options">
                    <div class="analysis-type selected" id="recruitmentAnalysis">
                        <h3>üéØ Recruitment Feedback</h3>
                        <p>KAAP11 methodiek voor recruiter gesprekken (via ChatGPT)</p>
                    </div>
                    <div class="analysis-type" id="customAnalysis">
                        <h3>‚öôÔ∏è Custom Feedback</h3>
                        <p>Eigen instructies (via ChatGPT)</p>
                    </div>
                </div>
            </div>
            
            <div class="input-group">
                <textarea id="customInstruction" class="custom-instruction" placeholder="Beschrijf hier je eigen feedback instructies..."></textarea>
            </div>
            
            <button id="generateFeedbackBtn" class="success-btn" disabled>Genereer Feedback</button>
            
            <div class="progress-bar" id="feedbackProgressBar">
                <div class="progress-fill" id="feedbackProgressFill"></div>
            </div>
            
            <div id="feedbackStatus" class="status"></div>
        </div>

        <!-- Feedback Result -->
        <div class="section" id="feedbackSection" style="display:none;">
            <h2>Feedback Resultaat</h2>
            <div class="input-group">
                <label>Gegenereerde Feedback:</label>
                <textarea id="feedbackResult" readonly></textarea>
            </div>
            
            <div class="btn-group">
                <button id="newFeedbackBtn" class="secondary-btn">Nieuwe Feedback</button>
                <button id="restartBtn" class="secondary-btn">Herstart Tool</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let audioData = null;
        let currentAnalysisType = 'recruitment';
        let candidateType = null;
        
        // Recruitment instruction
        const recruitmentInstruction = `# Feedback Agent voor Recruiter Intakegesprekken

## Rol en Doel
Je bent een feedback agent gespecialiseerd in het analyseren van kandidaat intakegesprekken van recruiters. Je taak is om constructieve feedback te geven gebaseerd op de Kaap11 training methodieken voor 'Kandidaat intake' en 'Verleiden van je kandidaat'.

## Feedback Methodiek
Gebruik een aangepaste versie van de CHECK methode, aangepast voor eenzijdige schriftelijke feedback:

### Stap 1: Identificeer het gesprektype (VERPLICHT)
Bepaal eerst of het een gesprek betreft met:
- **Actief zoekende kandidaat** (voor openstaande vacature/opdracht)
- **Latente kandidaat** (ori√´nterend gesprek voor toekomstige samenwerking)

Als dit niet duidelijk is uit de context, vraag dit expliciet aan de gebruiker.

### Stap 2: Evalueer per focuspunt
Geef feedback op de relevante aspecten gebaseerd op het gesprektype:

#### Voor Actief Zoekende Kandidaten:
Structureer feedback volgens het **RedCarpet Intakeformulier**:

**1. Opening - Eerste Indruk**
- Voorstellen (naam, bedrijf, specialisme)
- Aanleiding (bron van contact)
- Routeplanner (verwachtingen schets)
- Check beschikbaarheid

**2. Intake - De Verdieping**
- **Wat kan je?** (werkervaring, vaardigheden, competenties)
- **Wat wil je?** (werkomgeving, functie, arbeidsvoorwaarden)
- **Commitment & Status** (motivatie, beschikbaarheid, andere sollicitaties)

**3. Vervolg - De Pitch**
- Match aangeven
- Verwachtingen managen
- Dossier aanvullen

**4. Afsluiten**
- Samenvatting & situatie schetsen
- Concrete vervolgafspraak
- Actiepunten benoemen

#### Voor Latente Kandidaten:
Gebruik het **W.E.R.K. model** en **6 stappen gesprekscyclus**:

**W.E.R.K. Model:**
- **Wensen & ambities** (toekomstige carri√®redoelen)
- **Ervaring en werkzaamheden** (huidig en verleden)
- **Recruitment** (zoekgedrag en ervaring met bureaus)
- **Kandidaat** (persoonlijke aspecten, relatiebuilding)

**6 Stappen Gesprekscyclus:**
1. **Voorbereiding** (research, strategie)
2. **Opening** (5-stappen structuur + pimpen)
3. **Gespreksfase** (W.E.R.K. + LRD techniek)
4. **Pitch** (organisatie, team, jij)
5. **Afsluiten** (vervolgstappen bepalen)
6. **Opvolgen** (relatiebeheer)

**4 Fases Relatieopbouw:**
- Know ‚Üí Like ‚Üí Trust ‚Üí Recommend

### Stap 3: Geef Concrete Feedback
Voor elk focuspunt:

**Feedback (leren van situatie):**
- Wat ging goed? Waarom was dit effectief?
- Wat ging minder goed? Wat was het effect hiervan?

**Feedforward (toekomst):**
- Wat kan behouden blijven? Hoe?
- Wat kan anders/beter? Concrete suggesties?

### Stap 4: Belangrijkste Leerpunten
Vat samen:
- Top 3 sterke punten
- Top 3 verbeterpunten met concrete acties
- Specifieke aanbevelingen voor volgende gesprekken

### Stap 5: Aanmoediging
Sluit af met motiverende woorden en vertrouwen in verbetering.

## Specifieke Aandachtspunten

### Gespreks- en Vraagtechnieken
- **LRD techniek** (Luisteren, Reageren, Doorvragen)
- **Open vragen** en goede inleiding
- **Containerbegrippen** en **subjectieve begrippen** herkennen
- **STAR methodiek** voor competentie-uitvragen

### Relatieopbouw (vooral latente kandidaten)
- Persoonlijke connectie maken
- Vertrouwen opbouwen door expertise tonen
- Interesse tonen in persoon achter het CV

### Commerci√´le Focus
- **GASS methode** (Gets, Accepts, Starts, Stays)
- Urgentie cre√´ren waar relevant
- Verwachtingen managen
- Commitment peilen en versterken

### Dienstverlening Context
Houd rekening met deze diensten:
1. **Werving & Selectie** (direct in dienst bij opdrachtgever)
2. **Detachering** (in dienst bij bureau)
3. **Deta-vast** (eerst detachering, dan vast)
4. **Interim/Freelance** (ZZP opdrachten)

## Feedback Stijl
- **Constructief en specifiek**: Geef concrete voorbeelden
- **Gebalanceerd**: Balans tussen lof en verbeterpunten
- **Ontwikkelingsgericht**: Focus op groei en leren
- **Praktisch**: Directe tips die morgen toegepast kunnen worden
- **Motiverend**: Sluit positief af met aanmoediging

## Template Start
Begin elke feedback met:
"Bedankt voor het delen van je gesprek. Ik ga je feedback geven op basis van de Kaap11 methodiek. Eerst wil ik bevestigen: was dit een gesprek met een **actief zoekende** of **latente** kandidaat?"

[Wacht op bevestiging voordat je verder gaat met de analyse]`;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedKeys();
            setupEventListeners();
        });
        
        function loadSavedKeys() {
            const openaiKey = localStorage.getItem('openai_api_key');
            
            if (openaiKey) document.getElementById('openaiKey').value = openaiKey;
            
            validateInputs();
        }
        
        function setupEventListeners() {
            // Input validation
            document.getElementById('openaiKey').addEventListener('input', validateInputs);
            document.getElementById('audioFile').addEventListener('change', handleFileUpload);
            
            // Main actions
            document.getElementById('transcribeBtn').addEventListener('click', startTranscription);
            document.getElementById('detectCandidateTypeBtn').addEventListener('click', detectCandidateType);
            document.getElementById('proceedToFeedbackBtn').addEventListener('click', proceedToFeedback);
            document.getElementById('generateFeedbackBtn').addEventListener('click', generateFeedback);
            
            // Analysis type selection
            document.getElementById('recruitmentAnalysis').addEventListener('click', () => selectAnalysisType('recruitment'));
            document.getElementById('customAnalysis').addEventListener('click', () => selectAnalysisType('custom'));
            
            // Control buttons
            document.getElementById('newFeedbackBtn').addEventListener('click', newFeedback);
            document.getElementById('restartBtn').addEventListener('click', restartTool);
            
            // Text input validation
            document.getElementById('customInstruction').addEventListener('input', validateFeedbackGeneration);
            document.getElementById('transcriptionResult').addEventListener('input', validateTranscriptionStep);
            document.getElementById('candidateTypeSelect').addEventListener('change', validateCandidateTypeStep);
        }
        
        function validateInputs() {
            const openaiKey = document.getElementById('openaiKey').value;
            const hasAudio = audioData !== null;
            
            document.getElementById('transcribeBtn').disabled = !openaiKey || !hasAudio;
        }
        
        function validateTranscriptionStep() {
            const transcription = document.getElementById('transcriptionResult').value.trim();
            document.getElementById('detectCandidateTypeBtn').disabled = !transcription;
        }
        
        function validateCandidateTypeStep() {
            const selectedType = document.getElementById('candidateTypeSelect').value;
            document.getElementById('proceedToFeedbackBtn').disabled = !selectedType;
        }
        
        function validateFeedbackGeneration() {
            const transcription = document.getElementById('transcriptionResult').value.trim();
            const hasInstruction = currentAnalysisType === 'recruitment' || 
                                   document.getElementById('customInstruction').value.trim();
            const hasCandidateType = candidateType !== null;
            
            document.getElementById('generateFeedbackBtn').disabled = !transcription || !hasInstruction || (currentAnalysisType === 'recruitment' && !hasCandidateType);
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) {
                audioData = null;
                validateInputs();
                return;
            }
            
            // Check file size (25MB limit)
            if (file.size > 25 * 1024 * 1024) {
                showStatus('Bestand te groot. Maximum 25MB toegestaan.', 'error');
                return;
            }
            
            // Check file type
            const extension = file.name.toLowerCase().split('.').pop();
            const supportedFormats = ['mp3', 'wav', 'm4a', 'ogg', 'webm', 'flac'];
            
            if (!supportedFormats.includes(extension)) {
                showStatus('Niet ondersteund formaat. Gebruik: MP3, WAV, M4A, OGG, WEBM of FLAC.', 'error');
                return;
            }
            
            audioData = file;
            
            // Show audio player
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.src = URL.createObjectURL(file);
            audioPlayer.style.display = 'block';
            
            const sizeInMB = (file.size / 1024 / 1024).toFixed(1);
            showStatus(`‚úÖ Audio geladen: ${file.name} (${sizeInMB}MB)`, 'success');
            
            validateInputs();
        }
        
        async function startTranscription() {
            const openaiKey = document.getElementById('openaiKey').value;
            
            if (!audioData || !openaiKey) return;
            
            // Update UI
            setButtonState('transcribeBtn', true);
            updateSteps(2);
            showProgress(25);
            showStatus('üöÄ Audio wordt verstuurd naar OpenAI Whisper...', 'success');
            
            try {
                // Prepare form data
                const formData = new FormData();
                formData.append('file', audioData);
                formData.append('model', 'whisper-1');
                formData.append('language', 'nl');
                
                showProgress(50);
                
                // Make API call
                const response = await fetch('https://api.openai.com/v1/audio/transcriptions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiKey}`
                    },
                    body: formData
                });
                
                showProgress(75);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`OpenAI API error (${response.status}): ${errorText}`);
                }
                
                const result = await response.json();
                
                if (!result.text) {
                    throw new Error('Geen transcriptie ontvangen van OpenAI');
                }
                
                // Show results
                document.getElementById('transcriptionResult').value = result.text;
                document.getElementById('transcriptionSection').style.display = 'block';
                
                // For recruitment analysis, show candidate type detection
                if (currentAnalysisType === 'recruitment') {
                    document.getElementById('candidateTypeSection').style.display = 'block';
                    validateTranscriptionStep();
                } else {
                    document.getElementById('analysisSection').style.display = 'block';
                    validateFeedbackGeneration();
                }
                
                showProgress(100);
                showStatus('‚úÖ Transcriptie voltooid! Scroll naar beneden voor de volgende stap.', 'success');
                
                // Save API key
                localStorage.setItem('openai_api_key', openaiKey);
                
                // Auto-resize textarea
                autoResizeTextarea(document.getElementById('transcriptionResult'));
                
                setTimeout(() => {
                    hideProgress();
                    if (currentAnalysisType === 'recruitment') {
                        updateSteps(3);
                    } else {
                        updateSteps(4);
                        document.getElementById('analysisSection').style.display = 'block';
                        validateFeedbackGeneration();
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Transcription error:', error);
                showStatus(`‚ùå Transcriptie fout: ${error.message}`, 'error');
                hideProgress();
                updateSteps(1);
            } finally {
                setButtonState('transcribeBtn', false);
            }
        }
        
        async function detectCandidateType() {
            const openaiKey = document.getElementById('openaiKey').value;
            const transcription = document.getElementById('transcriptionResult').value.trim();
            
            if (!openaiKey || !transcription) return;
            
            // Update UI
            setButtonState('detectCandidateTypeBtn', true);
            showCandidateProgress(25);
            showCandidateStatus('üîç ChatGPT analyseert het kandidaat type...', 'success');
            
            try {
                const candidateDetectionPrompt = `Analyseer deze recruiter-kandidaat transcriptie en bepaal het type kandidaat op basis van deze criteria:

**ACTIEF ZOEKENDE KANDIDAAT - Signalen:**
- Expliciet zoekgedrag: "Ik ben op zoek naar...", "Ik solliciteer momenteel...", "Ik heb al gesprekken gehad bij..."
- Urgentie indicatoren: "Zo snel mogelijk", "binnen X weken beschikbaar", "mijn opzegtermijn is..."
- Concrete verwachtingen: Specifieke salariseisen, concrete functiewensen, duidelijke eisen aan werkgever
- Actieve engagement: Veel vragen over de vacature, processtappen, timing
- Status updates: "Ik zit in een proces bij...", "Ik heb morgen een gesprek..."

**LATENTE KANDIDAAT - Signalen:**
- Passieve interesse: "Ik houd mijn ogen open", "als er iets voorbij komt...", "hangt ervan af..."
- Voorwaardelijk: "Alleen voor het juiste aanbod", "moet wel echt beter zijn dan nu"
- Exploratie taal: "Benieuwd naar...", "zou wel eens willen weten...", "hangt af van de omstandigheden"
- Geen urgentie: "Ik heb geen haast", "zit goed waar ik nu zit, maar..."
- Informatie zoeken: Meer vragen over de markt, trends, mogelijkheden dan concrete vacature

**NIET ZOEKENDE KANDIDAAT - Signalen:**
- Expliciet afwijzend: "Ik ben niet op zoek", "heel tevreden waar ik zit"
- Geen interesse: Korte antwoorden, weinig engagement
- Sterke binding: "Geweldige werkgever", "fantastisch team", recent promotie/verhoging

TRANSCRIPTIE:
${transcription}

GEEF JE ANALYSE IN DEZE STRUCTUUR:
1. **CONCLUSIE:** [ACTIEF ZOEKEND/LATENT/NIET ZOEKEND]
2. **BEWIJS UIT TRANSCRIPTIE:** [Concrete citaten die je conclusie ondersteunen]
3. **MOTIVATIE:** [Waarom je tot deze conclusie komt]

Wees specifiek en gebruik concrete voorbeelden uit de tekst.`;
                
                showCandidateProgress(50);
                
                // Make ChatGPT API call
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${openaiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: [
                            { 
                                role: 'user', 
                                content: candidateDetectionPrompt 
                            }
                        ],
                        max_tokens: 1500,
                        temperature: 0.2
                    })
                });
                
                showCandidateProgress(75);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('ChatGPT API Error:', errorText);
                    throw new Error(`ChatGPT API error (${response.status}): ${errorText}`);
                }
                
                const result = await response.json();
                
                if (!result.choices || !result.choices[0] || !result.choices[0].message || !result.choices[0].message.content) {
                    throw new Error('Geen analyse ontvangen van ChatGPT');
                }
                
                const analysis = result.choices[0].message.content;
                
                // Extract candidate type from analysis
                let detectedType = '';
                if (analysis.includes('ACTIEF ZOEKEND')) {
                    detectedType = 'actief';
                } else if (analysis.includes('LATENT')) {
                    detectedType = 'latent';
                } else if (analysis.includes('NIET ZOEKEND')) {
                    detectedType = 'niet-zoekend';
                }
                
                // Show results
                document.getElementById('candidateAnalysis').value = analysis;
                document.getElementById('candidateTypeResult').style.display = 'block';
                
                // Pre-select detected type
                if (detectedType) {
                    document.getElementById('candidateTypeSelect').value = detectedType;
                    validateCandidateTypeStep();
                }
                
                showC
